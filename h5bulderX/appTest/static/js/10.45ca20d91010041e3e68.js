webpackJsonp([10],{"2Us7":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});s("OgVB");var a=s("/Lyv"),o=s.n(a),i=s("Xxa5"),n=s.n(i),l=s("exGp"),c=s.n(l),r=s("teIl"),u=s("uWBr"),d=s("sfuR"),p=s("dUF/"),v=(r.a,null),m=!1,f={name:"strategy",components:{Header:r.a},data:function(){return{stockDetail:{},organ:{},customer:{},optionData:[{}],userMonery:{can_bring_money:0},selectedTab:0,leverageSelect:0,selfMoney:0,winStopAt:0,loseStopAt:0,lowestStop:0,buyNumber:0,discount:function(){var t=parseInt(this.optionData[this.selectedTab].fee_time),e=0;return t>0&&(e=p.a.multiply(this.delayFee(),t).toFixed(2)),this.coupons.length>0&&-1!==this.selectedCouponIndex&&(e=p.a.add(e,this.coupons[this.selectedCouponIndex].div_money)),e},totalMoney:function(){return this.selfMoney*Number(this.leverageSelect)},buyCost:function(){return p.a.multiply(this.stockDetail.now_price,this.buyNumber)},quanshangFeeRatio:function(){var t=2===parseInt(this.stockDetail.market_id)?parseFloat(this.optionData[this.selectedTab].jianguan_fee):0;return t=p.a.add(t,parseFloat(this.optionData[this.selectedTab].gui_fee)),t=p.a.add(t,parseFloat(this.optionData[this.selectedTab].guohu_fee))},guanliFeeRatio:function(){return p.a.add(parseFloat(this.customer.add_service),parseFloat(this.optionData[this.selectedTab].service_fee))},shouxuFeeRatio:function(){return p.a.add(parseFloat(this.customer.add_buy_commission),parseFloat(this.optionData[this.selectedTab].buy_commission))},feeDesc:function(){var t=[];return this.quanshangFeeRatio()>0&&t.push("券商代收"),this.guanliFeeRatio()>0&&t.push("管理费"),this.shouxuFeeRatio()>0&&t.push("手续费"),t.join("+")},fee:function(){var t=this.buyCost(),e=p.a.multiply(t,this.quanshangFeeRatio()),s=p.a.multiply(t,this.guanliFeeRatio()),a=this.shouxuFeeRatio();a=Math.max(p.a.multiply(t,a),5);var o=p.a.add(e,s);return o=p.a.add(o,a).toFixed(2)},delayFee:function(){var t=p.a.add(parseFloat(this.optionData[this.selectedTab].delay_fee),parseFloat(this.customer.add_delay_fee));return p.a.multiply(this.buyCost(),t).toFixed(2)},payMoney:function(){var t=p.a.add(parseFloat(this.selfMoney),parseFloat(this.fee()));return p.a.add(t,p.a.multiply(this.delayFee(),parseInt(this.optionData[this.selectedTab].delay_days)))},finalMoney:function(){return this.payMoney()-this.discount()},selectedCouponIndex:-1,coupons:[],couponsData:{}}},mounted:function(){m=!1,this.loadStrategy()},beforeDestroy:function(){m=!0,null!==v&&(clearTimeout(v),v=null)},watch:{selfMoney:function(){this.buyNumber=100*Math.floor(this.totalMoney()/parseFloat(this.stockDetail.now_price)/100),this.loadAvailableCoupons(),this.selfMoney=String(this.selfMoney).replace(/[^\d]/g,"")},leverageSelect:function(){this.buyNumber=100*Math.floor(this.totalMoney()/parseFloat(this.stockDetail.now_price)/100),this.loseStopAt=parseFloat(this.stockDetail.now_price*(1-1/this.leverageSelect)).toFixed(2),this.lowestStop=parseFloat(this.stockDetail.now_price*(1-1/this.leverageSelect)).toFixed(2)}},methods:{loadStrategy:function(){var t=this;return c()(n.a.mark(function e(){var s,a,o;return n.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(u.u)(t.$store.state.User.token,t.$route.params.code);case 2:if(200===(s=e.sent).code){for(a=s.data.policy,o=0;o<a.length;o++)a[o].policy_leverage=a[o].policy_leverage.split(",");t.optionData=a,t.stockDetail=s.data.stock,t.userMonery=s.data.usermoney,t.organ=s.data.organ,t.customer=s.data.customer,d.a.fetchFromLocal("inputMoney")?t.selfMoney=Number(d.a.fetchFromLocal("inputMoney")):t.selfMoney=1e4*t.optionData[t.selectedTab].policy_money,t.leverageSelect=t.optionData[0].policy_leverage[0],t.winStopAt=parseFloat(t.stockDetail.now_price*(1+parseFloat(t.optionData[t.selectedTab].tp_limit))).toFixed(2),t.loadStock()}case 4:case"end":return e.stop()}},e,t)}))()},loadStock:function(){var t=this;return c()(n.a.mark(function e(){var s;return n.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(u.r)(t.$route.params.code,t.$store.state.User.token,!0);case 2:(s=e.sent).code&&200===s.code&&(t.stockDetail=s.data),m||(v=setTimeout(t.loadStock,3e3));case 5:case"end":return e.stop()}},e,t)}))()},onNewsTabItemClicked:function(t){this.selectedTab=t,d.a.fetchFromLocal("inputMoney")?this.selfMoney=Number(d.a.fetchFromLocal("inputMoney")):this.selfMoney=1e4*this.optionData[this.selectedTab].policy_money,this.selectedCouponIndex=-1,this.coupons=this.couponsData[this.optionData[this.selectedTab].id]||[],this.leverageSelect=this.optionData[this.selectedTab].policy_leverage[0],this.loseStopAt=parseFloat(this.stockDetail.now_price*(1-1/(1+this.leverageSelect))).toFixed(2),this.lowestStop=parseFloat(this.stockDetail.now_price*(1-1/(1+this.leverageSelect))).toFixed(2)},reduceWin:function(){this.winStopAt-.01>0&&(this.winStopAt=(parseFloat(this.winStopAt)-.01).toFixed(2))},addWin:function(){this.winStopAt=(parseFloat(this.winStopAt)+.01).toFixed(2)},reduceLose:function(){this.loseStopAt-.01>0&&(this.loseStopAt=(parseFloat(this.loseStopAt)-.01).toFixed(2))},addLose:function(){this.loseStopAt=(parseFloat(this.loseStopAt)+.01).toFixed(2)},submit:function(){var t=this;this.stockDetail.hasOwnProperty("stock_code")?parseFloat(this.selfMoney)<parseFloat(this.optionData[this.selectedTab].min_money)?window.EventBus.$emit("globalMessage","本金不能少于"+this.optionData[this.selectedTab].min_money):parseFloat(this.selfMoney)>this.optionData[this.selectedTab].max_money?window.EventBus.$emit("globalMessage","本金最多不能超过"+this.optionData[this.selectedTab].max_money):0!==this.buyNumber?o.a.confirm("请确认是否已详细了解了交易所需的费用和可能面临的风险，点击继续提交订单","确认下单",{confirmButtonText:"继续"}).then(c()(n.a.mark(function e(){return n.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.buy();case 1:case"end":return e.stop()}},e,t)})),function(){}):window.EventBus.$emit("globalMessage","当前选项可购买股数为0"):window.EventBus.$emit("globalMessage","数据加载失败，请稍候重试")},loadAvailableCoupons:function(){var t=this;return c()(n.a.mark(function e(){var s;return n.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(u.y)(t.$store.state.User.token,t.selfMoney,t.optionData[t.selectedTab].id);case 2:(s=e.sent).code&&200===s.code&&s.data.hasOwnProperty("coupon")?(t.couponsData=s.data.coupon,t.coupons=s.data.coupon[t.optionData[t.selectedTab].id]||[]):(t.couponsData={},t.coupons=[],t.selectedCouponIndex=-1);case 4:case"end":return e.stop()}},e,t)}))()},buy:function(){var t=this;return c()(n.a.mark(function e(){var s;return n.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s=Math.floor((parseFloat(t.selfMoney)+parseFloat(t.selfMoney)*t.leverageSelect)/parseFloat(t.stockDetail.now_price)),e.next=3,Object(u.A)(t.$store.state.User.token,t.stockDetail.stock_code,t.selfMoney,t.leverageSelect,t.stockDetail.now_price,s,t.optionData[t.selectedTab].id,t.winStopAt,t.loseStopAt,t.selectedCouponIndex>-1?t.coupons[t.selectedCouponIndex].coupon_code:null);case 3:200===e.sent.code&&(d.a.saveToLocal("inputMoney",t.selfMoney),window.EventBus.$emit("globalMessage","下单成功"),t.$router.push({path:"/strategy"}));case 5:case"end":return e.stop()}},e,t)}))()}}},_={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"mfw-page with-header page-strategy-create"},[s("Header",{attrs:{title:"创建策略"}}),t._v(" "),s("div",{staticClass:"tab-con"},[s("div",{staticClass:"mfw-tab"},[s("ul",t._l(t.optionData,function(e,a){return s("li",{key:a,staticClass:"tab-item",class:{on:t.selectedTab===a},on:{click:function(e){t.onNewsTabItemClicked(a)}}},[t._v("\n          "+t._s(e.policy_name)),s("span",{staticClass:"tab-divide-line"})])}))])]),t._v(" "),s("div",{staticClass:"mfw-page-section"},[s("div",{staticClass:"section-content pd0"},[s("div",{staticClass:"form-item"},[s("div",{staticClass:"stock-info pd20"},[s("div",{staticClass:"l"},[s("p",[s("strong",[s("span",{staticClass:"stock-name"},[t._v(t._s(t.stockDetail.stock_name))])])]),t._v(" "),s("p",[s("span",{staticClass:"stock-code"},[t._v(t._s(t.$route.params.code))])])]),t._v(" "),s("div",{staticClass:"c"},[s("p",[s("span",{staticClass:"number big",class:{"number-up":t.stockDetail.dif_money>0,"number-down":t.stockDetail.dif_money<0}},[t._v(t._s(t.stockDetail.now_price))])]),t._v(" "),s("p",{staticClass:"clear-fix"},[s("span",{staticClass:"float-left number",class:{"number-up":t.stockDetail.dif_money>0,"number-down":t.stockDetail.dif_money<0}},[t._v(t._s(t.stockDetail.dif_money))]),t._v(" "),s("span",{staticClass:"float-right number",class:{"number-up":t.stockDetail.dif_money>0,"number-down":t.stockDetail.dif_money<0}},[t._v(t._s(t.stockDetail.dif_rate)+"%")])])]),t._v(" "),s("div",{staticClass:"r"},[s("router-link",{attrs:{to:"/stock/"+t.$route.params.code}},[t._v("行情"),s("em",{staticClass:"arrow-r dark"})])],1)])])])]),t._v(" "),s("div",{staticClass:"mfw-page-section"},[s("div",{staticClass:"section-content"},[s("div",{staticClass:"form-item"},[s("div",{staticClass:"t form-item-flex  pd20"},[s("div",{staticClass:"form-label"},[t._v("保证金：")]),t._v(" "),s("div",{staticClass:"form-content"},[s("br"),t._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:t.selfMoney,expression:"selfMoney"}],staticClass:"width-sm",attrs:{type:"text"},domProps:{value:t.selfMoney},on:{input:function(e){e.target.composing||(t.selfMoney=e.target.value)}}}),t._v(" "),s("br"),t._v(" "),s("span",{staticClass:"font-sm gray2"},[t._v("(最少"+t._s(t.optionData[t.selectedTab].min_money)+"，最高"+t._s(t.optionData[t.selectedTab].max_money)+")")])])]),t._v(" "),s("div",{staticClass:"t form-item-flex pd20"},[s("div",{staticClass:"form-label"},[t._v("投资人配比：")]),t._v(" "),s("div",{staticClass:"form-content"},t._l(t.optionData[t.selectedTab].policy_leverage,function(e,a){return s("div",{key:a,staticClass:"leverage-item"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.leverageSelect,expression:"leverageSelect"}],staticClass:"radio-select",attrs:{id:"radio_"+a,type:"radio",name:"pz-ratio"},domProps:{value:e,checked:t._q(t.leverageSelect,e)},on:{change:function(s){t.leverageSelect=e}}}),t._v(" "),s("label",{staticClass:"radio-label",attrs:{for:"radio_"+a}},[t._v(t._s(t.selfMoney*e))])])}))]),t._v(" "),s("div",{staticClass:"t form-item-flex pd20"},[s("div",{staticClass:"form-label"},[t._v("操盘资金：")]),t._v(" "),s("div",{staticClass:"form-content"},[s("span",{staticClass:"number"},[t._v(t._s(t.totalMoney()))])])]),t._v(" "),s("div",{staticClass:"d form-item-flex pd20"},[s("div",{staticClass:"form-label"},[t._v("强平线：")]),t._v(" "),s("div",{staticClass:"form-content"},[t._v("\n            净资产/保证金 <= "+t._s(100*parseFloat(t.organ.risk_margin_limit))+"%\n          ")])])])])]),t._v(" "),s("div",{staticClass:"mfw-page-section"},[s("div",{staticClass:"section-content pd0"},[s("div",{staticClass:"form-item"},[s("div",{staticClass:"t form-item-flex"},[s("div",{staticClass:"form-label"},[t._v("现价买入：")]),t._v(" "),s("div",{staticClass:"form-content"},[s("span",{staticClass:"number"},[t._v(t._s(t.stockDetail.now_price))]),t._v(" "),s("span",{staticClass:"gray2"},[t._v("可买"),s("i",[t._v(t._s(t.buyNumber))]),t._v("股")])])]),t._v(" "),s("div",{staticClass:"t form-item-flex"},[s("div",{staticClass:"form-label"},[t._v("止盈：")]),t._v(" "),s("div",{staticClass:"form-content"},[s("div",{staticClass:"amount-select"},[s("button",{staticClass:"button reduce",on:{click:t.reduceWin}},[t._v("－")]),t._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:t.winStopAt,expression:"winStopAt"}],staticClass:"val",attrs:{type:"text"},domProps:{value:t.winStopAt},on:{input:function(e){e.target.composing||(t.winStopAt=e.target.value)}}}),t._v(" "),s("button",{staticClass:"button add",on:{click:t.addWin}},[t._v("＋")])])])]),t._v(" "),s("div",{staticClass:"t form-item-flex"},[s("div",{staticClass:"form-label"},[t._v("止损：")]),t._v(" "),s("div",{staticClass:"form-content"},[s("div",{staticClass:"amount-select"},[s("button",{staticClass:"button reduce",attrs:{disabled:parseFloat(t.loseStopAt)<=parseFloat(t.lowestStop)},on:{click:t.reduceLose}},[t._v("－")]),t._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:t.loseStopAt,expression:"loseStopAt"}],staticClass:"val",attrs:{type:"text"},domProps:{value:t.loseStopAt},on:{input:function(e){e.target.composing||(t.loseStopAt=e.target.value)}}}),t._v(" "),s("button",{staticClass:"button add",on:{click:t.addLose}},[t._v("＋")])])])]),t._v(" "),s("div",{staticClass:"d form-item-flex"},[s("div",{staticClass:"form-label"},[t._v("预计可赚：")]),t._v(" "),s("div",{staticClass:"form-content"},[s("span",{staticClass:"number number-up"},[t._v(t._s(parseFloat((this.winStopAt-t.stockDetail.now_price)*t.buyNumber).toFixed(2)))])])])])])]),t._v(" "),s("div",{staticClass:"mfw-page-section"},[s("div",{staticClass:"section-content pd0"},[s("div",{staticClass:"form-item"},[s("div",{staticClass:"t form-item-flex"},[s("div",{staticClass:"form-label"},[t._v("服务费：")]),t._v(" "),s("div",{staticClass:"form-content"},[s("span",{staticClass:"number"},[t._v(t._s(t.fee()))]),t._v(" \n            "),s("span",{staticClass:"gray2 font-sm"},[t._v("("+t._s(this.feeDesc())+")")])])]),t._v(" "),s("div",{staticClass:"t form-item-flex"},[s("div",{staticClass:"form-label"},[t._v("递延费：")]),t._v(" "),s("div",{staticClass:"form-content"},[s("span",{staticClass:"number"},[t._v(t._s(t.delayFee()))]),t._v(" "),s("span",{staticClass:"gray2 font-sm"},[t._v("（元/交易日）")])])]),t._v(" "),s("div",{staticClass:"t form-item-flex"},[s("div",{staticClass:"form-label"},[t._v("持仓时间：")]),t._v(" "),s("div",{staticClass:"form-content"},[s("span",{staticClass:"number"},[t._v(t._s(this.optionData[this.selectedTab].policy_time))]),t._v("天 "),s("span",{staticClass:"gray2 font-sm"},[t._v("（"+t._s(this.optionData[this.selectedTab].policy_time_text)+"）")])])]),t._v(" "),s("div",{staticClass:"t form-item-flex"},[s("div",{staticClass:"form-label"},[t._v("共计(元)：")]),t._v(" "),s("div",{staticClass:"form-content"},[s("br"),t._v(" "),s("span",{staticClass:"number number-up"},[t._v(t._s(t.payMoney()))]),t._v(" "),s("br"),t._v(" "),s("span",{staticClass:"gray2 font-sm"},[t._v("(准备资金=保证金+服务费+递延费*天数)")])])]),t._v(" "),s("div",{staticClass:"t form-item-flex"},[s("div",{staticClass:"form-label"},[t._v("优惠(元)：")]),t._v(" "),s("div",{staticClass:"form-content clear-fix"},[s("span",{staticClass:"number number-up"},[t._v(t._s(t.discount()))]),t._v(" "),s("span",{staticClass:"gray2 font-sm"},[t._v("（免息时间："+t._s(this.optionData[this.selectedTab].fee_time)+"天）")]),t._v(" "),s("span",{staticClass:"float-right menu-coupon"},[t._v("优惠券 "),s("span",{staticClass:"gray2 font-sm"},[t._v("("+t._s(t.coupons.length)+"张可用)")])])])]),t._v(" "),s("div",{staticClass:"coupon-list-con"},[s("p",{directives:[{name:"show",rawName:"v-show",value:t.coupons.length<1,expression:"coupons.length < 1"}],staticClass:"gray2 font-sm no-coupon"},[t._v("无可用优惠券")]),t._v(" "),s("ul",{staticClass:"coupon-list"},t._l(t.coupons,function(e,a){return s("li",{key:a},[s("label",{staticClass:"mfw-radio-item"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.selectedCouponIndex,expression:"selectedCouponIndex"}],staticClass:"mfw-radio-input",attrs:{type:"radio"},domProps:{value:a,checked:t._q(t.selectedCouponIndex,a)},on:{change:function(e){t.selectedCouponIndex=a}}}),t._v(" "),s("span",{staticClass:"mfw-radio-labe"},[t._v("\n                  "+t._s(e.div_money)+"元优惠券\n                  "),s("span",{staticClass:"gray2 font-sm"},[t._v("(满"+t._s(e.limit_money)+"可用)")])])])])}))]),t._v(" "),s("div",{staticClass:"t form-item-flex"},[s("div",{staticClass:"form-label"},[t._v("用户支付：")]),t._v(" "),s("div",{staticClass:"form-content"},[s("span",{staticClass:"number big number-up"},[t._v(t._s(t.finalMoney()))]),t._v("元\n          ")])]),t._v(" "),s("div",{staticClass:"d form-item-flex"},[s("div",{staticClass:"form-label"},[t._v("可用资金：")]),t._v(" "),s("div",{staticClass:"form-content"},[s("span",{staticClass:"number big number-up"},[t._v(t._s(t.userMonery.can_bring_money))]),t._v("元\n          ")])])])])]),t._v(" "),s("div",{staticClass:"menus"},[s("button",{staticClass:"button mfw-button primary size-lg",on:{click:t.submit}},[t._v("买入")])])],1)},staticRenderFns:[]};var h=s("VU/8")(f,_,!1,function(t){s("WE9T")},null,null);e.default=h.exports},WE9T:function(t,e){},"dUF/":function(t,e,s){"use strict";e.a={isInteger:function(t){return Math.floor(t)===t},toInteger:function(t){var e={times:1,num:0},s=t<0;if(this.isInteger(t))return e.num=t,e;var a=t+"",o=a.indexOf("."),i=a.substr(o+1).length,n=Math.pow(10,i),l=parseInt(Math.abs(t)*n+.5,10);return e.times=n,s&&(l=-l),e.num=l,e},operation:function(t,e,s,a){var o=this.toInteger(t),i=this.toInteger(e),n=o.num,l=i.num,c=o.times,r=i.times,u=c>r?c:r;switch(a){case"add":return(c===r?n+l:c>r?n+l*(c/r):n*(r/c)+l)/u;case"subtract":return(c===r?n-l:c>r?n-l*(c/r):n*(r/c)-l)/u;case"multiply":return n*l/(c*r);case"divide":return n/l*(r/c)}},add:function(t,e,s){return this.operation(t,e,s,"add")},subtract:function(t,e,s){return this.operation(t,e,s,"subtract")},multiply:function(t,e,s){return this.operation(t,e,s,"multiply")},divide:function(t,e,s){return this.operation(t,e,s,"divide")}}}});
//# sourceMappingURL=10.45ca20d91010041e3e68.js.map